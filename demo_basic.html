<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>LooseMachine Basic demo</title>
    <script src="LooseMachine.js"></script>
</head>
<body>
<h3>LooseMachine demo</h3>
<p>
    <input type="button" id="test" value="TEST"/>
</p>
<p>
    Open the dev tools to see the console debug output.
</p>
<script>
    var runBasicExample, actionDirector = (new LooseMachine.Director()).enableDebug();
// TEST
    document.getElementById("test").addEventListener("click", function() {runBasicExample();});
    runBasicExample = function() {
         var myAction = (new LooseMachine.Action("test", {defaultState:"state1"}))
            .setDirector(actionDirector) // Notifies it enter/leave events
            .onEnter(function(action) {
                console.log("action enter bubbled "+action.getId());
            })
            .onLeave(function(action) {
                console.log("action leave bubbled "+action.getId());
            })
            .addState( (new LooseMachine.ActionState("state1"))
                .onEnter(function(actionState) {
                    console.log("state enter bubbled "+actionState.getAction().getId()+"/"+actionState.getId());
                    alert(actionState.getAction().getId()+"/"+actionState.getId());
                    actionState.getAction().getState("state2").enter();
                })
                .onLeave(function(actionState) {
                    console.log("state leave bubbled "+actionState.getAction().getId()+"/"+actionState.getId());
                })
            )
            .addState( (new LooseMachine.ActionState("state2"))
                .onEnter(function(actionState) {
                    console.log("state enter bubbled "+actionState.getAction().getId()+"/"+actionState.getId());
                    alert(actionState.getAction().getId()+"/"+actionState.getId());
                    actionState.getAction().getState("state3").enter();
                })
                .onLeave(function(actionState) {
                    console.log("state leave bubbled "+actionState.getAction().getId()+"/"+actionState.getId());
                })
            )
            .addState( (new LooseMachine.ActionState("state3"))
                 .onEnter(function(actionState) {
                     console.log("state enter bubbled "+actionState.getAction().getId()+"/"+actionState.getId());
                     alert(actionState.getAction().getId()+"/"+actionState.getId()+": ### COMPLETED! ###");
                     actionState.getAction().leave(); // Leave the action, it will be automatically reseted
                 })
                 .onLeave(function(actionState) {
                     console.log("state leave bubbled "+actionState.getAction().getId()+"/"+actionState.getId());
                 })
            );
         myAction.enter();
    }
</script>

</body>
</html>